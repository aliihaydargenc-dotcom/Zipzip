<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hafƒ±za Ustasƒ± üß†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: meshGradient 15s ease infinite;
            color: white;
            position: relative;
        }

        @keyframes meshGradient {

            0%,
            100% {
                background-position: 0% 50%;
            }

            25% {
                background-position: 100% 50%;
            }

            50% {
                background-position: 50% 100%;
            }

            75% {
                background-position: 50% 0%;
            }
        }

        /* Floating shapes background */
        .shapes-container {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            animation: float 20s infinite ease-in-out;
        }

        .shape:nth-child(1) {
            width: 150px;
            height: 150px;
            left: 10%;
            top: 20%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 100px;
            height: 100px;
            right: 15%;
            top: 40%;
            animation-delay: 3s;
        }

        .shape:nth-child(3) {
            width: 120px;
            height: 120px;
            left: 50%;
            bottom: 20%;
            animation-delay: 6s;
        }

        .shape:nth-child(4) {
            width: 80px;
            height: 80px;
            right: 30%;
            bottom: 30%;
            animation-delay: 9s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-50px) rotate(180deg);
            }
        }

        /* Start Screen */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(83, 52, 131, 0.95));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.5s ease;
        }

        .start-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .game-title {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4, #ff6b6b, #ffd700);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
        }

        @keyframes shimmer {
            to {
                background-position: 200% center;
            }
        }

        .start-subtitle {
            font-size: 1.5rem;
            margin-bottom: 50px;
            opacity: 0.9;
            text-align: center;
            padding: 0 20px;
        }

        .btn-play {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 25px 60px;
            font-size: 2rem;
            font-weight: 700;
            border-radius: 60px;
            cursor: pointer;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .btn-play:hover {
            transform: translateY(-5px) scale(1.08);
            box-shadow: 0 20px 50px rgba(102, 126, 234, 0.8);
        }

        /* Game Container */
        .game-container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HUD */
        .hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .hud-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }

        .hud-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .hud-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffd700;
        }

        .timer {
            color: #ff6b6b;
            font-size: 2rem;
        }

        .timer.warning {
            animation: timerPulse 1s infinite;
        }

        @keyframes timerPulse {

            0%,
            100% {
                color: #ff6b6b;
                transform: scale(1);
            }

            50% {
                color: #ff3838;
                transform: scale(1.1);
            }
        }

        .joker-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.5);
            transition: all 0.3s ease;
        }

        .joker-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(240, 147, 251, 0.7);
        }

        .joker-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Theme Badge */
        .theme-badge {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(250, 112, 154, 0.4);
            text-align: center;
            margin-bottom: 20px;
        }

        /* Game Board */
        .game-board-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
        }

        .game-board {
            display: grid;
            gap: 12px;
            perspective: 1000px;
            max-width: 100%;
        }

        .game-board.combo-fire {
            animation: comboGlow 1s ease;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
            border-radius: 20px;
            padding: 10px;
        }

        @keyframes comboGlow {

            0%,
            100% {
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            }

            50% {
                box-shadow: 0 0 60px rgba(255, 215, 0, 1);
            }
        }

        /* Card Styling */
        .card {
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            animation: matchBounce 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
        }

        @keyframes matchBounce {
            0% {
                transform: rotateY(180deg) scale(1);
            }

            25% {
                transform: rotateY(180deg) scale(1.3);
            }

            50% {
                transform: rotateY(180deg) scale(0.9);
            }

            75% {
                transform: rotateY(180deg) scale(1.1);
            }

            100% {
                transform: rotateY(180deg) scale(1);
            }
        }

        .card.unmatched {
            animation: shake 0.5s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-15px) rotate(-5deg);
            }

            75% {
                transform: translateX(15px) rotate(5deg);
            }
        }

        .card.preview {
            animation: flipPreview 0.6s ease;
        }

        @keyframes flipPreview {
            0% {
                transform: rotateY(0deg);
            }

            100% {
                transform: rotateY(180deg);
            }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover .card-face {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
        }

        .card-front {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #ff9a56 100%);
            background-size: 200% 200%;
            animation: cardGradient 4s ease infinite;
        }

        @keyframes cardGradient {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .card-front::before {
            content: '?';
            font-size: 2.5rem;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.8);
        }

        .card-back {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            transform: rotateY(180deg);
            font-size: 2.5rem;
            color: #333;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.98), rgba(83, 52, 131, 0.98));
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-title {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-subtitle {
            font-size: 1.5rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .stars {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            font-size: 3rem;
        }

        .star {
            animation: starPop 0.5s ease backwards;
        }

        .star:nth-child(1) {
            animation-delay: 0.1s;
        }

        .star:nth-child(2) {
            animation-delay: 0.3s;
        }

        .star:nth-child(3) {
            animation-delay: 0.5s;
        }

        @keyframes starPop {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }

            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .btn-modal {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.3rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-modal:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.7);
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffd700;
            position: fixed;
            top: -10px;
            z-index: 5000;
            animation: confettiFall 3s ease-out forwards;
            pointer-events: none;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2.5rem;
            }

            .start-subtitle {
                font-size: 1.2rem;
            }

            .btn-play {
                padding: 20px 40px;
                font-size: 1.5rem;
            }

            .hud {
                padding: 15px;
            }

            .hud-value {
                font-size: 1.5rem;
            }

            .theme-badge {
                font-size: 1.1rem;
            }

            .game-board {
                gap: 8px;
            }

            .card-back {
                font-size: 2rem;
            }

            .modal-content {
                padding: 30px;
                max-width: 90%;
            }

            .modal-title {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .game-title {
                font-size: 2rem;
            }

            .btn-play {
                padding: 15px 30px;
                font-size: 1.2rem;
            }

            .hud-value {
                font-size: 1.2rem;
            }

            .card-front::before {
                font-size: 1.5rem;
            }

            .card-back {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- Background Shapes -->
    <div class="shapes-container">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
        <h1 class="game-title">üß† Hafƒ±za Ustasƒ± üß†</h1>
        <p class="start-subtitle">20 Seviye, 4 Tema, Sonsuz Eƒülence!</p>
        <button class="btn-play" onclick="startGame()">OYNA</button>
    </div>

    <!-- Game Container -->
    <div class="game-container">
        <!-- HUD -->
        <div class="hud">
            <div class="hud-item">
                <div class="hud-label">Seviye</div>
                <div class="hud-value" id="levelDisplay">1</div>
            </div>
            <div class="hud-item">
                <div class="hud-label">Hamle</div>
                <div class="hud-value" id="movesDisplay">0</div>
            </div>
            <div class="hud-item" id="timerContainer" style="display: none;">
                <div class="hud-label">S√ºre</div>
                <div class="hud-value timer" id="timerDisplay">0</div>
            </div>
            <div class="hud-item">
                <button class="joker-btn" id="jokerBtn" onclick="useJoker()">
                    üëÅÔ∏è G√∂z At (<span id="jokerCount">1</span>)
                </button>
            </div>
        </div>

        <!-- Theme Badge -->
        <div class="theme-badge" id="themeBadge">Hayvanlar üêØ</div>

        <!-- Game Board -->
        <div class="game-board-wrapper">
            <div class="game-board" id="gameBoard"></div>
        </div>
    </div>

    <!-- Win Modal -->
    <div class="modal" id="winModal">
        <div class="modal-content">
            <h2 class="modal-title">üéâ Tebrikler! üéâ</h2>
            <div class="stars" id="starsDisplay"></div>
            <p class="modal-subtitle" id="winMessage"></p>
            <button class="btn-modal" onclick="nextLevel()">Sonraki Seviye ‚û°Ô∏è</button>
            <button class="btn-modal" onclick="restartLevel()">Tekrar Dene üîÑ</button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2 class="modal-title">‚è∞ S√ºre Doldu! ‚è∞</h2>
            <p class="modal-subtitle">Tekrar deneyin ve rekor kƒ±rƒ±n!</p>
            <button class="btn-modal" onclick="restartLevel()">Tekrar Dene üîÑ</button>
        </div>
    </div>

    <script>
        // ============================================
        // GAME STATE & CONFIGURATION
        // ============================================

        const emojiThemes = {
            animals: {
                name: 'Hayvanlar üêØ',
                emojis: ['ü¶Å', 'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶í', 'ü¶ì', 'ü¶å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'ü¶Ü', 'ü¶â', 'ü¶Ö', 'ü¶ã', 'üêù', 'üêõ', 'ü¶ó', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï', 'üêô', 'ü¶ë']
            },
            food: {
                name: 'Yiyecekler üçï',
                emojis: ['üçé', 'üçå', 'üçá', 'üçì', 'üçí', 'üçë', 'üçç', 'ü•ù', 'üçî', 'üçï', 'üå≠', 'üåÆ', 'üçø', 'üç©', 'üç™', 'üéÇ', 'üç∞', 'üßÅ', 'üç¶', 'üçß', 'üç®', 'üç≠', 'üç¨', 'üç´', 'ü•§', 'üßÉ', 'üç∫', 'üç∑', 'ü•ó', 'üçù', 'üçú', 'üç±']
            },
            sports: {
                name: 'Spor & Aktivite üèÄ',
                emojis: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê', 'üèâ', 'üé±', 'üèì', 'üè∏', 'üèí', 'üèë', 'ü•ä', 'ü•ã', 'üéØ', 'üéÆ', 'üé≤', 'üé∏', 'üéπ', 'üé∫', 'üéª', 'ü•Å', 'üé®', 'üñåÔ∏è', 'üé≠', 'üé™', 'üé¨', 'üé§', 'üéß', 'üéº', 'üì∑', 'üì∏']
            },
            travel: {
                name: 'Seyahat & Nesneler üöÄ',
                emojis: ['üöÄ', 'üõ∏', 'üöÅ', 'üöÇ', 'üöÉ', 'üöÑ', 'üöÖ', 'üöÜ', 'üöá', 'üöà', 'üöâ', 'üöä', 'üöù', 'üöû', 'üöü', 'üö†', 'üö°', 'üö¢', '‚õµ', 'üõ•Ô∏è', 'üè∞', 'üóΩ', 'üóø', '‚õ©Ô∏è', 'üïå', '‚õ™', 'üíé', 'üíç', 'üîî', 'üéÅ', 'üéà', 'üéÄ']
            }
        };

        const gridConfigs = [
            { rows: 4, cols: 4, pairs: 8, time: 0 },      // Levels 1-4 (No timer)
            { rows: 4, cols: 6, pairs: 12, time: 240 },   // Levels 5-9
            { rows: 6, cols: 6, pairs: 18, time: 300 },   // Levels 10-14
            { rows: 6, cols: 8, pairs: 24, time: 360 },   // Levels 15-19
            { rows: 8, cols: 8, pairs: 32, time: 420 }    // Level 20
        ];

        let gameState = {
            currentLevel: 1,
            moves: 0,
            matches: 0,
            flippedCards: [],
            lockBoard: false,
            cards: [],
            timer: null,
            timeRemaining: 0,
            jokerAvailable: true,
            comboCount: 0,
            startTime: null,
            audioContext: null
        };

        // ============================================
        // AUDIO SYSTEM (Web Audio API)
        // ============================================

        function initAudio() {
            if (!gameState.audioContext) {
                gameState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            initAudio();
            const ctx = gameState.audioContext;
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);

            switch (type) {
                case 'flip':
                    oscillator.frequency.value = 400;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    oscillator.start(ctx.currentTime);
                    oscillator.stop(ctx.currentTime + 0.1);
                    break;

                case 'match':
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                    oscillator.start(ctx.currentTime);
                    oscillator.stop(ctx.currentTime + 0.3);

                    // Add a second tone for richness
                    const osc2 = ctx.createOscillator();
                    const gain2 = ctx.createGain();
                    osc2.connect(gain2);
                    gain2.connect(ctx.destination);
                    osc2.frequency.value = 1200;
                    osc2.type = 'sine';
                    gain2.gain.setValueAtTime(0.15, ctx.currentTime);
                    gain2.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                    osc2.start(ctx.currentTime + 0.05);
                    osc2.stop(ctx.currentTime + 0.35);
                    break;

                case 'error':
                    oscillator.frequency.value = 200;
                    oscillator.type = 'sawtooth';
                    gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    oscillator.start(ctx.currentTime);
                    oscillator.stop(ctx.currentTime + 0.2);
                    break;

                case 'win':
                    // Victory melody
                    const notes = [523, 587, 659, 784, 880];
                    notes.forEach((freq, i) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.frequency.value = freq;
                        osc.type = 'sine';
                        gain.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
                        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.3);
                        osc.start(ctx.currentTime + i * 0.15);
                        osc.stop(ctx.currentTime + i * 0.15 + 0.3);
                    });
                    break;
            }
        }

        // ============================================
        // GAME LOGIC
        // ============================================

        function getThemeForLevel(level) {
            if (level <= 5) return emojiThemes.animals;
            if (level <= 10) return emojiThemes.food;
            if (level <= 15) return emojiThemes.sports;
            return emojiThemes.travel;
        }

        function getGridConfigForLevel(level) {
            if (level <= 4) return gridConfigs[0];
            if (level <= 9) return gridConfigs[1];
            if (level <= 14) return gridConfigs[2];
            if (level <= 19) return gridConfigs[3];
            return gridConfigs[4];
        }

        function startGame() {
            // Load saved progress
            const savedLevel = localStorage.getItem('hafizaUstasiLevel');
            if (savedLevel) {
                gameState.currentLevel = parseInt(savedLevel);
            }

            document.getElementById('startScreen').classList.add('hidden');
            initLevel();
        }

        function initLevel() {
            const theme = getThemeForLevel(gameState.currentLevel);
            const config = getGridConfigForLevel(gameState.currentLevel);

            // Reset state
            gameState.moves = 0;
            gameState.matches = 0;
            gameState.flippedCards = [];
            gameState.lockBoard = false;
            gameState.cards = [];
            gameState.jokerAvailable = true;
            gameState.comboCount = 0;
            gameState.startTime = Date.now();

            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }

            // Update UI
            document.getElementById('levelDisplay').textContent = gameState.currentLevel;
            document.getElementById('movesDisplay').textContent = gameState.moves;
            document.getElementById('themeBadge').textContent = theme.name;
            document.getElementById('jokerCount').textContent = '1';
            document.getElementById('jokerBtn').disabled = false;

            // Timer setup
            if (config.time > 0) {
                gameState.timeRemaining = config.time;
                document.getElementById('timerContainer').style.display = 'flex';
                document.getElementById('timerDisplay').textContent = formatTime(gameState.timeRemaining);
                startTimer();
            } else {
                document.getElementById('timerContainer').style.display = 'none';
            }

            // Generate cards
            const shuffledEmojis = [...theme.emojis].sort(() => Math.random() - 0.5);
            const selectedEmojis = shuffledEmojis.slice(0, config.pairs);
            const cardEmojis = [...selectedEmojis, ...selectedEmojis];
            cardEmojis.sort(() => Math.random() - 0.5);

            // Setup board
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            gameBoard.style.gridTemplateColumns = `repeat(${config.cols}, 1fr)`;
            gameBoard.style.gridTemplateRows = `repeat(${config.rows}, 1fr)`;

            // Calculate card size
            const maxWidth = window.innerWidth * 0.9;
            const maxHeight = window.innerHeight * 0.5;
            const cardSize = Math.min(
                Math.floor(maxWidth / config.cols) - 12,
                Math.floor(maxHeight / config.rows) - 12,
                100
            );

            // Create cards
            cardEmojis.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.width = `${cardSize}px`;
                card.style.height = `${cardSize}px`;
                card.dataset.emoji = emoji;
                card.dataset.index = index;

                card.innerHTML = `
                    <div class="card-face card-front"></div>
                    <div class="card-face card-back">${emoji}</div>
                `;

                card.addEventListener('click', () => flipCard(card));
                gameBoard.appendChild(card);
                gameState.cards.push(card);
            });

            // Preview mechanic - show all cards for 2 seconds
            showPreview();
        }

        function showPreview() {
            gameState.lockBoard = true;
            gameState.cards.forEach(card => {
                card.classList.add('flipped', 'preview');
            });

            setTimeout(() => {
                gameState.cards.forEach(card => {
                    card.classList.remove('flipped', 'preview');
                });
                gameState.lockBoard = false;
            }, 2000);
        }

        function flipCard(card) {
            if (gameState.lockBoard) return;
            if (card === gameState.flippedCards[0]) return;
            if (card.classList.contains('matched')) return;
            if (card.classList.contains('flipped')) return;

            playSound('flip');
            card.classList.add('flipped');
            gameState.flippedCards.push(card);

            if (gameState.flippedCards.length === 2) {
                checkMatch();
            }
        }

        function checkMatch() {
            gameState.lockBoard = true;
            gameState.moves++;
            document.getElementById('movesDisplay').textContent = gameState.moves;

            const [card1, card2] = gameState.flippedCards;
            const isMatch = card1.dataset.emoji === card2.dataset.emoji;

            if (isMatch) {
                handleMatch(card1, card2);
            } else {
                handleMismatch(card1, card2);
            }
        }

        function handleMatch(card1, card2) {
            playSound('match');

            setTimeout(() => {
                card1.classList.add('matched');
                card2.classList.add('matched');

                gameState.matches++;
                gameState.comboCount++;

                // Combo fire effect
                if (gameState.comboCount >= 2) {
                    document.getElementById('gameBoard').classList.add('combo-fire');
                    setTimeout(() => {
                        document.getElementById('gameBoard').classList.remove('combo-fire');
                    }, 1000);
                }

                gameState.flippedCards = [];
                gameState.lockBoard = false;

                // Check win condition
                const config = getGridConfigForLevel(gameState.currentLevel);
                if (gameState.matches === config.pairs) {
                    setTimeout(handleLevelComplete, 500);
                }
            }, 600);
        }

        function handleMismatch(card1, card2) {
            playSound('error');
            gameState.comboCount = 0; // Reset combo

            setTimeout(() => {
                card1.classList.add('unmatched');
                card2.classList.add('unmatched');

                setTimeout(() => {
                    card1.classList.remove('flipped', 'unmatched');
                    card2.classList.remove('flipped', 'unmatched');
                    gameState.flippedCards = [];
                    gameState.lockBoard = false;
                }, 500);
            }, 800);
        }

        function handleLevelComplete() {
            if (gameState.timer) {
                clearInterval(gameState.timer);
            }

            playSound('win');

            const stars = calculateStars();
            showWinModal(stars);
            createConfetti();

            // Save progress
            if (gameState.currentLevel < 20) {
                localStorage.setItem('hafizaUstasiLevel', gameState.currentLevel + 1);
            }
        }

        function calculateStars() {
            const config = getGridConfigForLevel(gameState.currentLevel);
            const timeTaken = (Date.now() - gameState.startTime) / 1000;
            const perfectMoves = config.pairs;
            const moveRatio = gameState.moves / perfectMoves;

            // Star criteria
            if (moveRatio <= 1.2 && (config.time === 0 || timeTaken < config.time * 0.5)) {
                return 3; // Perfect
            } else if (moveRatio <= 1.5 && (config.time === 0 || timeTaken < config.time * 0.75)) {
                return 2; // Good
            } else {
                return 1; // Completed
            }
        }

        function showWinModal(stars) {
            const modal = document.getElementById('winModal');
            const starsDisplay = document.getElementById('starsDisplay');
            const winMessage = document.getElementById('winMessage');

            starsDisplay.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const star = document.createElement('span');
                star.className = 'star';
                star.textContent = i < stars ? '‚≠ê' : '‚òÜ';
                starsDisplay.appendChild(star);
            }

            winMessage.textContent = `Seviye ${gameState.currentLevel} tamamlandƒ±! ${gameState.moves} hamle kullandƒ±nƒ±z.`;
            modal.classList.add('show');
        }

        function nextLevel() {
            document.getElementById('winModal').classList.remove('show');

            if (gameState.currentLevel >= 20) {
                alert('üéâ Tebrikler! T√ºm seviyeleri tamamladƒ±nƒ±z! üéâ');
                gameState.currentLevel = 1;
                localStorage.setItem('hafizaUstasiLevel', 1);
            } else {
                gameState.currentLevel++;
            }

            initLevel();
        }

        function restartLevel() {
            document.getElementById('winModal').classList.remove('show');
            document.getElementById('gameOverModal').classList.remove('show');
            initLevel();
        }

        function useJoker() {
            if (!gameState.jokerAvailable) return;

            gameState.jokerAvailable = false;
            gameState.lockBoard = true;
            document.getElementById('jokerBtn').disabled = true;
            document.getElementById('jokerCount').textContent = '0';

            // Show all cards for 1 second
            gameState.cards.forEach(card => {
                if (!card.classList.contains('matched')) {
                    card.classList.add('flipped');
                }
            });

            setTimeout(() => {
                gameState.cards.forEach(card => {
                    if (!card.classList.contains('matched')) {
                        card.classList.remove('flipped');
                    }
                });
                gameState.lockBoard = false;
            }, 1000);
        }

        function startTimer() {
            gameState.timer = setInterval(() => {
                gameState.timeRemaining--;
                const timerDisplay = document.getElementById('timerDisplay');
                timerDisplay.textContent = formatTime(gameState.timeRemaining);

                if (gameState.timeRemaining <= 30) {
                    timerDisplay.classList.add('warning');
                }

                if (gameState.timeRemaining <= 0) {
                    clearInterval(gameState.timer);
                    handleGameOver();
                }
            }, 1000);
        }

        function handleGameOver() {
            gameState.lockBoard = true;
            document.getElementById('gameOverModal').classList.add('show');
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function createConfetti() {
            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#f093fb', '#48dbfb'];

            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        // Responsive resize
        window.addEventListener('resize', () => {
            if (gameState.cards.length > 0) {
                const config = getGridConfigForLevel(gameState.currentLevel);
                const maxWidth = window.innerWidth * 0.9;
                const maxHeight = window.innerHeight * 0.5;
                const cardSize = Math.min(
                    Math.floor(maxWidth / config.cols) - 12,
                    Math.floor(maxHeight / config.rows) - 12,
                    100
                );
                gameState.cards.forEach(card => {
                    card.style.width = `${cardSize}px`;
                    card.style.height = `${cardSize}px`;
                });
            }
        });
    </script>
</body>

</html>
