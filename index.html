<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Sky Jumper - Master Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-user-select: none; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: #020617; font-family: 'Outfit', sans-serif; touch-action: none; }
        
        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 100%;
            margin: 0 auto;
            background: linear-gradient(180deg, #1e1e2e 0%, #0f0f1a 100%);
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* ARAY√úZ (HUD) */
        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 10;
        }
        .hud-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            padding: 8px 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            text-align: center;
        }
        .hud-label { font-size: 10px; opacity: 0.7; letter-spacing: 1px; text-transform: uppercase; }
        .hud-value { font-family: 'Fredoka One'; font-size: 20px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

        /* MEN√úLER */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.3s;
        }
        .hidden { opacity: 0; pointer-events: none; }

        h1 {
            font-family: 'Fredoka One';
            font-size: 48px;
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-align: center;
            filter: drop-shadow(0 0 10px rgba(79, 172, 254, 0.5));
        }

        p { color: #94a3b8; margin-bottom: 30px; letter-spacing: 2px; font-size: 14px; }

        /* BUTONLAR */
        .btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            padding: 15px 50px;
            border-radius: 50px;
            color: white;
            font-family: 'Fredoka One';
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
            transition: transform 0.1s, box-shadow 0.1s;
            position: relative;
            overflow: hidden;
            z-index: 101; /* Canvas'ƒ±n √ºzerinde olmasƒ± ≈üart */
            pointer-events: auto; /* Tƒ±klanabilir olmasƒ± ≈üart */
        }
        .btn:active { transform: scale(0.95); box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4); }
        .btn-small { padding: 10px 20px; font-size: 16px; margin: 5px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }

        /* KARAKTER SE√áƒ∞Mƒ∞ */
        .skin-selector {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 20px;
        }
        .skin-display { font-size: 50px; filter: drop-shadow(0 0 15px rgba(255,255,255,0.3)); }
        .arrow-btn { background: none; border: none; color: white; font-size: 30px; cursor: pointer; padding: 0 15px; opacity: 0.7; }
        
        /* DOKUNMATƒ∞K KONTROL ALANLARI (G√ñR√úNMEZ) */
        .touch-area { position: absolute; bottom: 0; top: 0; width: 50%; z-index: 5; }
        .touch-left { left: 0; }
        .touch-right { right: 0; }
        
        /* G√ñRSEL GERƒ∞ Bƒ∞LDƒ∞Rƒ∞M */
        .touch-feedback {
            position: absolute; top:0; bottom:0; width: 50%;
            background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent);
            pointer-events: none; opacity: 0; transition: opacity 0.1s;
        }
        .touch-feedback.active { opacity: 1; }
        
        #comboText {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-family: 'Fredoka One'; font-size: 40px; color: #fbbf24;
            pointer-events: none; opacity: 0; z-index: 20;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.6);
        }
        .pop-anim { animation: popUp 0.5s ease-out forwards; }
        @keyframes popUp { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } 50% { transform: translate(-50%, -80%) scale(1.2); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 0; } }

    </style>
</head>
<body>

    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div class="touch-feedback touch-left" id="feedL"></div>
        <div class="touch-feedback touch-right" id="feedR" style="right:0; background: linear-gradient(-90deg, rgba(255,255,255,0.05), transparent);"></div>

        <div id="comboText"></div>

        <div class="hud" id="hud">
            <div class="hud-box">
                <div class="hud-label">SKOR</div>
                <div class="hud-value" id="scoreVal">0</div>
            </div>
            <div class="hud-box">
                <div class="hud-label">Y√úKSEKLƒ∞K</div>
                <div class="hud-value" id="heightVal">0m</div>
            </div>
        </div>

        <div id="mainMenu" class="overlay">
            <h1>SKY JUMPER</h1>
            <p>MASTER EDITION</p>
            
            <div class="skin-selector">
                <button class="arrow-btn" onclick="changeSkin(-1)">‚ùÆ</button>
                <div class="skin-display" id="skinDisp">üîµ</div>
                <button class="arrow-btn" onclick="changeSkin(1)">‚ùØ</button>
            </div>

            <button class="btn" onclick="startGame()">BA≈ûLA</button>
            
            <div style="margin-top: 20px; font-size: 12px; color: #64748b;">
                EN Y√úKSEK: <span id="bestScore" style="color: #fff; font-weight: bold;">0</span>
            </div>
        </div>

        <div id="gameOver" class="overlay hidden">
            <h1 style="font-size: 40px; color: #ef4444;">OYUN Bƒ∞TTƒ∞</h1>
            <div class="hud-box" style="margin: 20px; padding: 20px 40px;">
                <div class="hud-label">TOPLAM SKOR</div>
                <div class="hud-value" id="finalScore" style="font-size: 40px;">0</div>
            </div>
            <button class="btn" onclick="startGame()">TEKRAR</button>
            <button class="btn btn-small" onclick="showMenu()">MEN√ú</button>
        </div>
    </div>

    <script>
        // --- AYARLAR ---
        const C = {
            GRAVITY: 0.6,
            JUMP_FORCE: -16,    // Zƒ±plama g√ºc√º
            BOUNCE_FORCE: -16,  // Platformdan sekme g√ºc√º
            SPEED: 6,           // Yatay hƒ±z
            PLAT_W: 80,         // Platform geni≈üliƒüi
            PLAT_H: 14,
            GAP: 70             // Platformlar arasƒ± bo≈üluk
        };

        const SKINS = ['üîµ', '‚öΩ', 'üèÄ', 'üéæ', 'üé±', 'üåç', 'üëΩ', 'üëª', 'ü§ñ'];
        
        // --- DEƒûƒ∞≈ûKENLER ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let W, H;
        
        let state = {
            screen: 'menu', // menu, playing, gameover
            score: 0,
            height: 0,
            maxHeight: 0,
            cameraY: 0,
            best: localStorage.getItem('skyBest') || 0,
            skinIdx: 0
        };

        let player = { x: 0, y: 0, vx: 0, vy: 0, r: 15 };
        let platforms = [];
        let particles = [];
        let inputs = { left: false, right: false };

        // --- BA≈ûLATMA ---
        function resize() {
            W = canvas.width = document.getElementById('gameContainer').clientWidth;
            H = canvas.height = document.getElementById('gameContainer').clientHeight;
        }
        window.addEventListener('resize', resize);
        resize();
        document.getElementById('bestScore').innerText = state.best;

        // --- OYUN D√ñNG√úS√ú ---
        function startGame() {
            // UI G√ºncelleme
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('gameOver').classList.add('hidden');
            
            // Deƒüi≈ükenleri Sƒ±fƒ±rla
            state.screen = 'playing';
            state.score = 0;
            state.height = 0;
            state.maxHeight = 0;
            state.cameraY = 0;
            
            // Oyuncu Ba≈ülangƒ±√ß
            player.x = W / 2;
            player.y = H - 150;
            player.vx = 0;
            player.vy = C.JUMP_FORCE;

            // Platformlar
            platforms = [];
            // ƒ∞lk platform (g√ºvenli ba≈ülangƒ±√ß)
            platforms.push({ x: W/2 - C.PLAT_W/2, y: H - 50, type: 'normal', w: C.PLAT_W });
            
            generatePlatforms(H); // ƒ∞lk seti √ºret

            loop();
        }

        function showMenu() {
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
            state.screen = 'menu';
        }

        function changeSkin(dir) {
            state.skinIdx = (state.skinIdx + dir + SKINS.length) % SKINS.length;
            document.getElementById('skinDisp').innerText = SKINS[state.skinIdx];
        }

        // --- Fƒ∞Zƒ∞K VE MANTIK ---
        function update() {
            if (state.screen !== 'playing') return;

            // 1. Oyuncu Hareketi
            if (inputs.left) player.vx = -C.SPEED;
            else if (inputs.right) player.vx = C.SPEED;
            else player.vx *= 0.8; // S√ºrt√ºnme

            player.vy += C.GRAVITY;
            player.x += player.vx;
            player.y += player.vy;

            // Ekrandan √ßƒ±karsa diƒüer taraftan girsin
            if (player.x < -player.r) player.x = W;
            if (player.x > W) player.x = -player.r;

            // 2. Kamera Takibi (Sadece yukarƒ± gider)
            let targetY = player.y - H * 0.4;
            if (targetY < state.cameraY) {
                state.cameraY = targetY;
                // Skor g√ºncelleme
                let currentH = Math.floor(-state.cameraY / 10);
                if (currentH > state.maxHeight) {
                    state.maxHeight = currentH;
                    state.score += 1;
                    document.getElementById('scoreVal').innerText = state.score;
                    document.getElementById('heightVal').innerText = state.maxHeight + "m";
                }
            }

            // 3. Platform √áarpƒ±≈üma ve √úretim
            platforms.forEach(p => {
                // Sadece d√º≈üerken √ßarpƒ±≈üma olur (Icy Tower mantƒ±ƒüƒ±)
                if (player.vy > 0 && 
                    player.x + player.r > p.x && 
                    player.x - player.r < p.x + p.w &&
                    player.y + player.r > p.y && 
                    player.y + player.r < p.y + p.type === 'moving' ? 20 : 20 // Tolerans
                   ) {
                       // Platformun biraz √ºzerindeyse zƒ±plat
                       if (player.y - player.vy < p.y) {
                           player.vy = C.BOUNCE_FORCE;
                           createParticles(player.x, player.y + player.r, 5);
                           // Combo efekti eklenebilir
                       }
                }
                
                // Hareketli platform g√ºncelleme
                if (p.type === 'moving') {
                    p.x += p.speed;
                    if (p.x < 0 || p.x + p.w > W) p.speed *= -1;
                }
            });

            // Platform Temizliƒüi ve √úretimi
            platforms = platforms.filter(p => p.y - state.cameraY < H + 100);
            generatePlatforms(state.cameraY);

            // 4. √ñl√ºm Kontrol√º
            if (player.y - state.cameraY > H + 50) {
                gameOver();
            }

            // Partik√ºl G√ºncelleme
            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.05;
                if(p.life <= 0) particles.splice(i, 1);
            });
        }

        function generatePlatforms(refY) {
            // En √ºstteki platformu bul
            let highestY = H;
            if (platforms.length > 0) {
                highestY = platforms.reduce((min, p) => p.y < min ? p.y : min, platforms[0].y);
            }

            // Ekranƒ±n √ºst√ºne kadar doldur
            while (highestY > state.cameraY - 100) {
                highestY -= C.GAP;
                
                let type = 'normal';
                if (state.score > 50 && Math.random() > 0.8) type = 'moving';
                if (state.score > 100 && Math.random() > 0.9) type = 'break'; // Kƒ±rƒ±lan eklenebilir

                let w = C.PLAT_W;
                let x = Math.random() * (W - w);
                
                let p = { x: x, y: highestY, w: w, type: type };
                if (type === 'moving') p.speed = 2 + Math.random() * 2;
                
                platforms.push(p);
            }
        }

        function createParticles(x, y, count) {
            for(let i=0; i<count; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 5,
                    vy: (Math.random() - 0.5) * 5,
                    life: 1,
                    color: `hsl(${Math.random()*360}, 70%, 50%)`
                });
            }
        }

        function gameOver() {
            state.screen = 'gameover';
            if (state.score > state.best) {
                state.best = state.score;
                localStorage.setItem('skyBest', state.best);
            }
            document.getElementById('finalScore').innerText = state.score;
            document.getElementById('gameOver').classList.remove('hidden');
        }

        // --- √áƒ∞Zƒ∞M ---
        function draw() {
            // Arkaplan temizle
            ctx.clearRect(0, 0, W, H);

            if (state.screen === 'playing') {
                // Platformlar
                platforms.forEach(p => {
                    let py = p.y - state.cameraY;
                    
                    // G√∂lgelendirme
                    ctx.fillStyle = 'rgba(0,0,0,0.3)';
                    ctx.fillRect(p.x + 5, py + 5, p.w, C.PLAT_H);

                    // Ana renk
                    if (p.type === 'moving') ctx.fillStyle = '#facc15';
                    else ctx.fillStyle = '#a855f7';
                    
                    // Yuvarlatƒ±lmƒ±≈ü dikd√∂rtgen yerine d√ºz √ßizim (performans i√ßin)
                    ctx.fillRect(p.x, py, p.w, C.PLAT_H);
                    
                    // Parlama efekti
                    ctx.fillStyle = 'rgba(255,255,255,0.2)';
                    ctx.fillRect(p.x, py, p.w, C.PLAT_H/2);
                });

                // Oyuncu (Skin)
                let py = player.y - state.cameraY;
                ctx.font = "30px Arial";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                
                // Zƒ±plama efekti (scale)
                let scale = 1;
                if (player.vy < 0) scale = 1.1; // Zƒ±plarken uzasƒ±n
                
                ctx.save();
                ctx.translate(player.x, py);
                ctx.scale(1, scale);
                ctx.fillText(SKINS[state.skinIdx], 0, 0);
                ctx.restore();

                // Partik√ºller
                particles.forEach(p => {
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.life;
                    ctx.beginPath();
                    ctx.arc(p.x - state.cameraY*0, p.y - state.cameraY, 3, 0, Math.PI*2);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                });
            }
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        // --- KONTROLLER (MOBƒ∞L UYUMLU) ---
        
        const container = document.getElementById('gameContainer');

        // Masa√ºst√º
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowLeft' || e.key === 'a') inputs.left = true;
            if (e.key === 'ArrowRight' || e.key === 'd') inputs.right = true;
        });
        document.addEventListener('keyup', e => {
            if (e.key === 'ArrowLeft' || e.key === 'a') inputs.left = false;
            if (e.key === 'ArrowRight' || e.key === 'd') inputs.right = false;
        });

        // Mobil Dokunmatik (EN √ñNEMLƒ∞ KISIM)
        container.addEventListener('touchstart', e => {
            // Eƒüer dokunulan yer bir BUTON ise, oyun kontrol√ºn√º devreye sokma!
            if (e.target.tagName === 'BUTTON' || e.target.classList.contains('btn')) {
                return; 
            }
            
            e.preventDefault(); // Sayfanƒ±n kaymasƒ±nƒ± engelle ama butonu engelleme

            for (let i = 0; i < e.touches.length; i++) {
                let t = e.touches[i];
                let x = t.clientX - container.getBoundingClientRect().left;
                
                if (x < W / 2) {
                    inputs.left = true;
                    document.getElementById('feedL').classList.add('active');
                } else {
                    inputs.right = true;
                    document.getElementById('feedR').classList.add('active');
                }
            }
        }, { passive: false });

        container.addEventListener('touchend', e => {
            if (e.touches.length === 0) {
                inputs.left = false;
                inputs.right = false;
                document.getElementById('feedL').classList.remove('active');
                document.getElementById('feedR').classList.remove('active');
            }
        });

    </script>
</body>
</html>
